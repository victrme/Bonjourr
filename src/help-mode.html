<template id="help-mode-prompt-template">
    <div id="help-mode-prompt">
        <h1>üò∂‚Äçüå´Ô∏è Uh oh, Bonjourr had a problem.</h1>
        <p>Seems like a bug was triggered by an unexpected situation. <br>No worries though, as your settings were saved.</p>

        <div id="help-buttons">
            <button id="help-export" class="help-btn" title="Export a new settings file" aria-label="Export a new settings file">
                <img src="src/assets/labels/download.svg" height="16" alt="">
                <span class="trn">Download settings</span>
            </button>

            <button id="open-help-mode" class="help-btn" title="Export a new settings file" aria-label="Export a new settings file">
                <svg xmlns="http://www.w3.org/2000/svg" height="16" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                </svg>

                <span class="trn">Get help</span>
            </button>
        </div>
        

        <style>
            #help-mode-prompt {
                position: fixed;
                top: 40vh;
                left: 0;
                right: 0;
                color: #eeeeee;
                font-family: system-ui;
                font-size: 1em;
                text-align: center;
                z-index: 1;
            }

            #help-mode-prompt code {
                background-color: #555;
                padding: .3em;
                border-radius: .3em;
                margin-inline: .3em;
                }

            #help-buttons {
                display: flex;
                justify-content: center;
                gap: 1em;
                }

            .help-btn {
                cursor: pointer;
                height: 31px;
                padding: 0 1em;
                color: var(--color-blue);
                border: none;
                border-radius: 1em;
                white-space: nowrap;
                background-color: rgba(var(--blue),.25);
                display: inline-flex;
                justify-content: center;
                align-items: center;
                gap: 5px;
            }

            .help-btn:hover {
                background-color: rgba(var(--blue), .35);
            }

            .help-btn[disabled] {
                color: #777777;
                background-color: #282828;
                cursor: not-allowed;
            }
        </style>
    </div>
</template>

<template id="help-mode-template">
    <div id="help-mode">
        <div id="content">
            <h1>HELP MODE (beta)</h1>

            <p>Welcome to Help Mode! This page gives you all the resources you'll need to troubleshoot effectively and know what to do if Bonjourr were to break.</p>

            <div id="troubleshoot">
                <h2>ü§î I have a problem, what can I do?</h2>

                <p>Depending on the intensity of your problem and your investment level, there are essentially two ways you can go about this.</p>

                <details>
                    <summary>
                        <h3>The "I want to get on with my day" way</h3>
                    </summary>

                    <p>If you're experiencing a crash, you should know that they can often be quickly resolved by resetting your settings. <b class="important">If you do this however, you will lose your data, which is why you need to download it first.</b> You will then be able to start afresh or import it back into your new installation, at the bottom of the settings panel.</p>

                    <p>In some rare situations, the settings file itself might be what's causing the crash. In this case, we recommend following the next step to report the problem.</p>
                </details>

                <details>
                    <summary>
                        <h3>The "I need help and want to report this bug" way</h3>
                    </summary>

                    <p>If you are stuck in a bad situation and/or found a bug deserving attention, the best thing to do is get in touch with us. This can be done effectively in a few steps:</p>

                    <ol>
                        <li>First, you should check out the <a href="https://github.com/victrme/Bonjourr/issues">GitHub issues</a> to see if the bug hasn't already been reported.</li>
                        <li>If this isn't the case, you can either <a href="mailto:bonjourr.app@protonmail.com">send us an email</a> or create a new GitHub issue about your problem.</li>
                        <li>The two main things we will need to help are:
                            <ul>
                                <li><b>Context</b>. What is the problem? If Bonjourr crashed, were you doing something specific before the crash? And any other information you might think is relevant.</li>
                                <li><b>Your settings file</b> (download at the bottom of this page).</li>
                            </ul>
                        </li>
                    </ol>
                    
                    <i>Keep in mind that your settings file includes personal informations from your Bonjourr installation (notes, links, weather location...). Email might be a better solution in some cases, as it won't be public.</i>
                </details>
            </div>
            
            <div id="server-status">
                <h2>üóÑÔ∏è Server status</h2>
                <p>These are external services Bonjourr relies on to work properly. If any of them are down, it likely is the culprit. You can either wait for them to get back up again, or get in touch with us if you think we aren't aware of the problem.</p>

                <ul>
                    <li>Website <span id="help-status-website"> ¬∑ loading...</span><span></li>
                    <li>Weather <span id="help-status-weather"> ¬∑ loading...</span><span></li>
                    <li>Services <span id="help-status-services"> ¬∑ loading...</span><span></li>
                </ul>
            </div>

            <div id="storage-data">
                <h2>üíæ Storage</h2>

                <p>The way(s) Bonjourr stores data in your browser.</p>
                
                <details id="localstorage-container" class="hidden">
                    <summary>
                        <h4>Page storage <small>(localStorage)</small></h4>
                    </summary>

                    <p>Where Bonjourr stores all your data when using online.bonjourr.fr (settings, cache, backgrounds...).</p>

                    <ul id="help-localstorage"></ul>
                </details>

                <details open id="syncstorage-container" class="hidden">
                    <summary>
                        <h4>Synchronized <small>(browser.storage.sync)</small></h4>
                    </summary>

                    <p>Your critical user data, essentially all your settings except local backgrounds. This is what's inside your setttings file when you download it.</p>
                    <pre id="help-storage-sync" readonly></pre>
                </details>
                
                <details id="browserstorage-container" class="hidden">
                    <summary>
                        <h4>Local <small>(browser.storage.local)</small></h4>
                    </summary>

                    <p>This stores large data that cannot or does not need to be saved.</p>
                    <pre id="help-storage-local" readonly></pre>
                </details>
            </div>

            <div id="reset">
                <h2>üîÑ Settings management & reset</h2>

                <p>If you need to reset Bonjourr, please <b class="important">download your settings</b> and read the <a href="#troubleshoot">first section</a> of this guide first.</p>

                <div id="help-buttons">
                    <button id="help-export" class="help-btn" title="Export a new settings file" aria-label="Export a new settings file">
                        <img src="src/assets/labels/download.svg" height="16" alt="">
                        <span class="trn">Download settings</span>
                    </button>

                    <button disabled id="open-help-mode" class="help-btn" title="Export a new settings file" aria-label="Export a new settings file">
                        <svg xmlns="http://www.w3.org/2000/svg" height="16" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                        </svg>

                        <span class="trn">Reset Bonjourr</span>
                    </button>
                </div>
            </div>
        </div>

        <style>
            #help-mode {
                font-family: system-ui;
                color: #eeeeee;
                background-color: black;
                position: relative;
                z-index: 2;
                display: flow-root;
                padding: 0 20px;
            }

            #help-mode #content {
                max-width: 600px;
                margin: 4em auto;
            }

            #help-mode h1 {
                text-align: center;
            }

            #help-mode h2 {
                margin-top: 2em;
            }

            #help-mode pre {
                width: 100%;
                border: none;
                resize: vertical;
                font-family: var(--monospace-font-family);
                background-color: #1c1c1e;
                color: #eeeeee;
                border-radius: 10px;
                margin: 6px 0;
                padding: 15px 21px;
                max-width: 100%;
                height: 6em;
                box-sizing: border-box;
                /* white-space: pre-wrap; */
                text-wrap: wrap;
                overflow: auto;
                word-break: break-all;
            }

            #help-storage-sync,
            #help-storage-local {
                font-size: small;
                min-height: 200px;
            }

            .hidden {
                display: none;
            }

            .important {
                color: red;
            }

            details {
                border-radius: 4px;
                padding: 0.5em 0.5em 0;
            }

            summary {
                font-weight: bold;
                margin: -0.5em -0.5em 0;
                padding: 0.5em;
                cursor: pointer;
            }

            summary h3, summary h4 {
                display: inline;
            }

            details[open] {
                padding: 0.5em;
            }

            details[open] summary {
                border-bottom: 1px solid #aaaaaa;
                margin-bottom: 0.5em;
            }

            /* server statuses */

            #server-status ul {
                list-style: none;
            }

            #server-status ul li {
                position: relative;
            }

            #server-status ul li:before {
                content: "";
                position: absolute;
                width: .35rem;
                height: .35rem;
                top: 50%;
                transform: translateY(-50%);
                left: -0.85em;
                border-radius: 9999px;
                animation: pulse 2s ease infinite;
                background-color: #ff8000;
                box-shadow: 0 0 5px #ffb366;
            }

            #server-status ul li.statusUp:before {
                background-color: #00ff00;
                box-shadow: 0 0 5px #00ff00;
            }

            #server-status ul li.statusDown:before {
                background-color: #ff0000;
                box-shadow: 0 0 5px #ff4d4d;
            }

            @keyframes pulse {
                    0%, to {
                        opacity:1;
                        transform:scale(1) translateY(-50%)
                    }

                    50% {
                        opacity:.4;
                        transform:scale(1.2) translateY(-50%)
                    }
            }

        </style>
    </div>
</template>